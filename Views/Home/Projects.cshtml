@model List<(string Name, string Link, string Description)>
@using System.Text.Json
@{
    ViewData["Title"] = "Projelerim";
}

<div class="container mt-5">
    <h1 class="display-5 mb-4">Projelerim</h1>

    <!-- React root -->
    <div id="projects-react-root" data-projects='@Html.Raw(JsonSerializer.Serialize(Model))'></div>
</div>

@section Scripts {
    <!-- React + ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- React arama ve listeleme -->
    <script>
        (function () {
            const e = React.createElement;
            const { useState } = React;

            function ProjectCard({ project }) {
                return e('div', { className: 'col-md-6 col-lg-4 mb-4' },
                    e('div', { className: 'card h-100 shadow-sm' },
                        e('div', { className: 'card-body d-flex flex-column' },
                            e('h5', { className: 'card-title' }, project.Name),
                            e('p', { className: 'card-text flex-grow-1' }, project.Description),
                            e('a', { href: project.Link, target: '_blank', className: 'btn btn-primary mt-2' }, "GitHub'da Gör")
                        )
                    )
                );
            }

            function ProjectBoard({ initial }) {
                const [search, setSearch] = useState('');
                const filtered = initial.filter(p => p.Name.toLowerCase().includes(search.toLowerCase()));

                return e('div', null,
                    e('div', { className: 'mb-3' },
                        e('input', {
                            type: 'text',
                            placeholder: 'Proje ara...',
                            className: 'form-control',
                            value: search,
                            onChange: e => setSearch(e.target.value)
                        })
                    ),
                    e('div', { className: 'row g-4' },
                        filtered.length > 0
                            ? filtered.map((p, i) => e(ProjectCard, { key: i, project: p }))
                            : e('div', { className: 'col-12' },
                                e('div', { className: 'alert alert-info' }, 'Aradığınız projeye uygun sonuç bulunamadı.')
                            )
                    )
                );
            }

            const mount = document.getElementById('projects-react-root');
            if (mount) {
                const initial = JSON.parse(mount.getAttribute('data-projects'));
                const root = ReactDOM.createRoot(mount);
                root.render(e(ProjectBoard, { initial }));
            }
        })();
    </script>
}
